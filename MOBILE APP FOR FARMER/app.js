// Smallholder Farmer Mobile App - JavaScript
// Optimized for 414x896 pixel frame - Fixed with Event Listeners

// App Data and State Management - Karnataka Region
const appData = {
  farmer: {
    name: "рд░рд╛рдЬреЗрд╢ рдХреБрдорд╛рд░ рдЧреМрдбрд╝рд╛",
    name_english: "Rajesh Kumar Gowda",
    name_kannada: "р▓░р▓╛р▓Ьр│Зр▓╢р│Н р▓Хр│Бр▓ор▓╛р▓░р│Н р▓Чр│Мр▓б",
    farm_name: "рд╢реНрд░реА рд▓рдХреНрд╖реНрдореА рдкреЛрд▓реНрдЯреНрд░реА рдлрд╛рд░реНрдо",
    farm_name_english: "Sri Lakshmi Poultry Farm",
    farm_name_kannada: "р▓╢р│Нр▓░р│А р▓▓р▓Хр│Нр▓╖р│Нр▓ор│А р▓кр│Лр▓▓р│Нр▓Яр│Нр▓░р▓┐ р▓лр▓╛р▓░р│Нр▓ор│Н",
    farm_id: "KA-BLR-002",
    phone: "+91 9845123456",
    location: "Devanahalli Taluk, Bengaluru Rural",
    location_kannada: "р▓жр│Зр▓╡р▓ир▓╣р▓│р│Нр▓│р▓┐ р▓др▓╛р▓▓р│Вр▓Хр│Б, р▓мр│Жр▓Вр▓Чр▓│р│Вр▓░р│Б р▓Чр│Нр▓░р▓╛р▓ор│Ар▓г",
    animal_count: 750,
    district: "Bengaluru Rural",
    state: "Karnataka",
    pin_code: "562110"
  },
  emergency_contacts: [
    {
      name: "Dr. Suresh Nayak",
      name_kannada: "р▓бр▓╛. р▓╕р│Бр▓░р│Зр▓╢р│Н р▓ир▓╛р▓пр▓Хр│Н",
      role: "Veterinarian", 
      phone: "+91 9845234567",
      location: "Devanahalli"
    },
    {
      name: "Karnataka Animal Hospital",
      name_kannada: "р▓Хр▓░р│Нр▓ир▓╛р▓Яр▓Х р▓кр▓╢р│Б р▓Жр▓╕р│Нр▓кр▓др│Нр▓░р│Ж",
      role: "Emergency",
      phone: "+91 9845345678",
      location: "Bengaluru"
    },
    {
      name: "KVAFSU Helpline",
      name_kannada: "р▓Хр│Жр▓╡р▓┐р▓Ор▓Ор▓лр│Нр▓Ор▓╕р│Нр▓пр│Б р▓╕р▓╣р▓╛р▓пр▓╡р▓╛р▓гр▓┐",
      role: "University Support",
      phone: "+91 9845456789",
      location: "Bidar"
    }
  ],
  market_data: {
    current_price: 88,
    currency: "тВ╣/kg",
    trend: "up",
    market_location: "KR Market, Bengaluru",
    last_updated: "Today 3:00 PM"
  }
};

// Current app state
let currentTab = 'dashboard';
let currentScanType = 'visitor';
let isScanning = false;
let currentMonth = 8; // September (0-indexed)
let currentYear = 2025;
let isVoicePlaying = false;

// Initialize app when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
  console.log('ЁЯМ╛ DOM Loaded - Initializing App...');
  initializeApp();
});

// Initialize the application
function initializeApp() {
  console.log('ЁЯМ╛ Initializing Kisan Sahayak App...');
  
  // Setup all event listeners first
  setupEventListeners();
  
  // Set initial tab
  setTimeout(() => {
    switchTab('dashboard');
  }, 100);
  
  // Initialize other components
  updateNetworkStatus();
  updateCalendar();
  
  // Show welcome message
  setTimeout(() => {
    showToast('ЁЯПа рдХрд┐рд╕рд╛рди рд╕рд╣рд╛рдпрдХ рдореЗрдВ рдЖрдкрдХрд╛ рд╕реНрд╡рд╛рдЧрдд рд╣реИ - Welcome to Kisan Sahayak', 'success');
  }, 1000);
  
  console.log('тЬЕ Kisan Sahayak App Ready');
}

// Setup all event listeners
function setupEventListeners() {
  console.log('ЁЯФз Setting up event listeners...');
  
  // Bottom Navigation Event Listeners
  const navItems = document.querySelectorAll('.nav-item');
  navItems.forEach(navItem => {
    navItem.addEventListener('click', function(e) {
      e.preventDefault();
      const tabName = this.getAttribute('data-tab');
      console.log('ЁЯзн Nav clicked:', tabName);
      if (tabName) {
        switchTab(tabName);
      }
    });
  });
  
  // Voice Assistant Button
  const voiceAssistantBtn = document.getElementById('voiceAssistantBtn');
  if (voiceAssistantBtn) {
    voiceAssistantBtn.addEventListener('click', activateVoiceAssistant);
  }
  
  // Voice Play Button with Ripple Effect
  const voicePlayBtn = document.getElementById('voicePlayBtn');
  if (voicePlayBtn) {
    voicePlayBtn.addEventListener('click', function(e) {
      createRippleEffect(e, this);
      playVoice();
    });
  }
  
  // Emergency Button
  const emergencyBtn = document.getElementById('emergencyBtn');
  if (emergencyBtn) {
    emergencyBtn.addEventListener('click', () => callEmergency('vet'));
  }
  
  // Market Button
  const marketBtn = document.getElementById('marketBtn');
  if (marketBtn) {
    marketBtn.addEventListener('click', openMarketPrices);
  }
  
  // Scan Type Buttons
  const scanTypeButtons = document.querySelectorAll('.scan-option-btn');
  scanTypeButtons.forEach(btn => {
    btn.addEventListener('click', function() {
      const scanType = this.getAttribute('data-scan-type');
      setScanType(scanType);
    });
  });
  
  // Scan Button
  const scanBtn = document.getElementById('scanBtn');
  if (scanBtn) {
    scanBtn.addEventListener('click', simulateScan);
  }
  
  // Close Scan Result Button
  const closeScanBtn = document.getElementById('closeScanBtn');
  if (closeScanBtn) {
    closeScanBtn.addEventListener('click', closeScanResult);
  }
  
  // Calendar Navigation
  const prevMonthBtn = document.getElementById('prevMonthBtn');
  const nextMonthBtn = document.getElementById('nextMonthBtn');
  if (prevMonthBtn) {
    prevMonthBtn.addEventListener('click', () => changeMonth(-1));
  }
  if (nextMonthBtn) {
    nextMonthBtn.addEventListener('click', () => changeMonth(1));
  }
  
  // Call Veterinarian Button
  const callVetBtn = document.getElementById('callVetBtn');
  if (callVetBtn) {
    callVetBtn.addEventListener('click', () => callEmergency('vet'));
  }
  
  // Alert Voice Buttons
  const voiceBtns = document.querySelectorAll('.voice-btn');
  voiceBtns.forEach(btn => {
    btn.addEventListener('click', function() {
      const alertType = this.getAttribute('data-alert-type');
      playAlertVoice(alertType);
    });
  });
  
  // More Tab Buttons
  const moreButtons = {
    'trainingBtn': openTraining,
    'marketPricesBtn': openMarketPrices,
    'weatherBtn': openWeatherForecast,
    'emergencyContactsBtn': openEmergencyContacts,
    'helpBtn': openHelp,
    'settingsBtn': openSettings,
    'profileBtn': openProfile,
    'schemesBtn': openSchemes,
    'chatBtn': openChat
  };
  
  Object.keys(moreButtons).forEach(btnId => {
    const btn = document.getElementById(btnId);
    if (btn) {
      btn.addEventListener('click', moreButtons[btnId]);
    }
  });
  
  // Touch feedback for mobile
  document.addEventListener('touchstart', function(e) {
    const target = e.target.closest('.btn') || 
                   e.target.closest('.nav-item') || 
                   e.target.closest('.more-item') ||
                   e.target.closest('.status-card') ||
                   e.target.closest('.alert-item') ||
                   e.target.closest('.scan-option-btn') ||
                   e.target.closest('.quick-action-btn');
    
    if (target) {
      target.style.opacity = '0.7';
    }
  }, { passive: true });
  
  document.addEventListener('touchend', function(e) {
    const target = e.target.closest('.btn') || 
                   e.target.closest('.nav-item') || 
                   e.target.closest('.more-item') ||
                   e.target.closest('.status-card') ||
                   e.target.closest('.alert-item') ||
                   e.target.closest('.scan-option-btn') ||
                   e.target.closest('.quick-action-btn');
    
    if (target) {
      setTimeout(() => {
        target.style.opacity = '';
      }, 150);
    }
  }, { passive: true });
  
  console.log('тЬЕ Event listeners setup complete');
}

// Tab switching functionality
function switchTab(tabName) {
  console.log('ЁЯФД Switching to tab:', tabName);
  
  try {
    // Hide all tab contents
    const allTabs = document.querySelectorAll('.tab-content');
    allTabs.forEach(tab => {
      tab.classList.remove('active');
    });
    
    // Remove active class from all nav items
    const allNavItems = document.querySelectorAll('.nav-item');
    allNavItems.forEach(nav => {
      nav.classList.remove('active');
    });
    
    // Show selected tab
    const targetTab = document.getElementById(tabName);
    if (targetTab) {
      targetTab.classList.add('active');
      console.log('тЬЕ Added active to tab:', tabName);
    } else {
      console.error('тЭМ Tab not found:', tabName);
      return false;
    }
    
    // Add active class to corresponding nav item
    const tabNames = ['dashboard', 'scan', 'alerts', 'schedule', 'more'];
    const tabIndex = tabNames.indexOf(tabName);
    
    if (tabIndex !== -1 && allNavItems[tabIndex]) {
      allNavItems[tabIndex].classList.add('active');
      console.log('тЬЕ Nav item activated:', tabIndex);
    }
    
    currentTab = tabName;
    
    // Show tab switch feedback
    showToast(`ЁЯУ▒ ${getTabDisplayName(tabName)} рдЦреБрд▓рд╛ рдЧрдпрд╛`, 'info');
    
    // Simulate haptic feedback
    simulateHapticFeedback();
    
    // Scroll to top of tab content
    if (targetTab) {
      targetTab.scrollTop = 0;
    }
    
    console.log('тЬЕ Tab switch completed:', tabName);
    return true;
    
  } catch (error) {
    console.error('тЭМ Error switching tabs:', error);
    showToast('тЪая╕П Navigation error - рдХреГрдкрдпрд╛ рджреЛрдмрд╛рд░рд╛ рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВ', 'error');
    return false;
  }
}

// Get display name for tabs
function getTabDisplayName(tabName) {
  const names = {
    dashboard: 'рдбреИрд╢рдмреЛрд░реНрдб - Dashboard',
    scan: 'рд╕реНрдХреИрди - Scan',
    alerts: 'рдЕрд▓рд░реНрдЯ - Alerts',
    schedule: 'рд╕рдордпрд╕рд╛рд░рдгреА - Schedule',
    more: 'рдЕрдзрд┐рдХ - More'
  };
  return names[tabName] || tabName;
}

// Voice Assistant Functions
function activateVoiceAssistant() {
  console.log('ЁЯОд Voice assistant activated');
  showToast('ЁЯОд рдЖрд╡рд╛рдЬ рд╕рд╣рд╛рдпрдХ рд╕рдХреНрд░рд┐рдп - Voice assistant activated', 'info');
  simulateHapticFeedback('success');
  
  setTimeout(() => {
    showToast('ЁЯФК "рдЖрдЬ рдореЗрд░реЗ рдлрд╛рд░реНрдо рдХреА рд╕реНрдерд┐рддрд┐ рдХреИрд╕реА рд╣реИ?" - How is my farm today?', 'success');
  }, 1500);
}

function playVoice() {
  console.log('ЁЯО╡ Voice play button clicked');
  const playBtn = document.getElementById('voicePlayBtn');
  
  if (!playBtn) {
    console.error('тЭМ Voice play button not found');
    return;
  }
  
  if (isVoicePlaying) {
    playBtn.innerHTML = '<i class="fas fa-play"></i>';
    isVoicePlaying = false;
    showToast('тП╣я╕П рдЖрд╡рд╛рдЬ рд░реБрдХ рдЧрдИ - Voice stopped', 'info');
  } else {
    playBtn.innerHTML = '<i class="fas fa-pause"></i>';
    isVoicePlaying = true;
    showToast('ЁЯО╡ рдЖрд╡рд╛рдЬ рдЪрд▓ рд░рд╣реА рд╣реИ - Playing voice message', 'success');
    
    // Add playing animation to voice icon
    const voiceIcon = document.querySelector('.voice-icon.animated');
    if (voiceIcon) {
      voiceIcon.style.animation = 'voicePulse 1s infinite';
    }
    
    setTimeout(() => {
      if (isVoicePlaying && playBtn) {
        playBtn.innerHTML = '<i class="fas fa-play"></i>';
        isVoicePlaying = false;
        showToast('тЬЕ рдЖрд╡рд╛рдЬ рдкреВрд░реА рд╣реБрдИ - Voice message complete', 'info');
        
        // Reset voice icon animation
        if (voiceIcon) {
          voiceIcon.style.animation = 'voicePulse 2s infinite';
        }
      }
    }, 5000);
  }
  
  simulateHapticFeedback();
}

// Create ripple effect for buttons
function createRippleEffect(event, element) {
  const ripple = element.querySelector('.play-ripple');
  if (!ripple) return;
  
  const rect = element.getBoundingClientRect();
  const size = Math.max(rect.width, rect.height);
  const x = event.clientX - rect.left - size / 2;
  const y = event.clientY - rect.top - size / 2;
  
  ripple.style.width = ripple.style.height = size + 'px';
  ripple.style.left = x + 'px';
  ripple.style.top = y + 'px';
  
  ripple.classList.remove('animate');
  ripple.classList.add('animate');
  
  setTimeout(() => {
    ripple.classList.remove('animate');
  }, 600);
}

function playAlertVoice(alertType) {
  console.log('ЁЯФК Playing alert voice:', alertType);
  const messages = {
    vaccination: 'ЁЯТЙ рдХрд▓ рд╕реБрдмрд╣ 10 рдмрдЬреЗ Newcastle Disease рдХрд╛ рдЯреАрдХрд╛рдХрд░рдг рд╣реИред 500 рдкрдХреНрд╖рд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП рдбреЙ. рдкреНрд░рд┐рдпрд╛ рдкрд╛рдЯрд┐рд▓ рдЖрдПрдВрдЧреЗред',
    temperature: 'ЁЯМбя╕П рд╢реЗрдб рдХрд╛ рддрд╛рдкрдорд╛рди рдереЛрдбрд╝рд╛ рдмрдврд╝рд╛ рд╣реБрдЖ рд╣реИред рд╣рд╡рд╛рджрд╛рд░ рдмрдирд╛рдиреЗ рдХреА рдЬрд░реВрд░рдд рд╣реИред',
    market: 'тВ╣ рдЖрдЬ рдмреНрд░реЙрдпрд▓рд░ рдХрд╛ рднрд╛рд╡ 85 рд░реБрдкрдпреЗ рдХрд┐рд▓реЛ рд╣реИред рдмреЗрдЪрдиреЗ рдХрд╛ рдЕрдЪреНрдЫрд╛ рд╕рдордп рд╣реИред',
    visitor: 'ЁЯЫбя╕П рд╕рднреА рдЖрдиреЗ рд╡рд╛рд▓реЗ рд▓реЛрдЧреЛрдВ рдХреЛ рдмреИрдЬ рд╕реНрдХреИрди рдХрд░рдирд╛ рдФрд░ рд╣рд╛рде рд╕рд╛рдл рдХрд░рдирд╛ рдЬрд░реВрд░реА рд╣реИред'
  };
  
  showToast(`ЁЯФК ${messages[alertType] || 'Alert voice message playing'}`, 'info');
  simulateHapticFeedback();
}

// Scan Functionality
function setScanType(type) {
  console.log('ЁЯУ╖ Setting scan type:', type);
  
  // Remove active class from all scan type buttons
  document.querySelectorAll('.scan-option-btn').forEach(btn => {
    btn.classList.remove('active');
  });
  
  // Add active class to selected button
  const targetBtn = document.querySelector(`[data-scan-type="${type}"]`);
  if (targetBtn) {
    targetBtn.classList.add('active');
  }
  
  currentScanType = type;
  
  const typeText = getScanTypeText(type);
  showToast(`ЁЯУ╖ рд╕реНрдХреИрди рдкреНрд░рдХрд╛рд░: ${typeText}`, 'info');
  simulateHapticFeedback();
}

function getScanTypeText(type) {
  const types = {
    visitor: 'рд╡рд┐рдЬрд╝рд┐рдЯрд░ рдмреИрдЬ - Visitor Badge',
    equipment: 'рдЙрдкрдХрд░рдг - Equipment',
    feed: 'рдЪрд╛рд░рд╛ - Feed'
  };
  return types[type] || 'рдЕрдЬреНрдЮрд╛рдд - Unknown';
}

function simulateScan() {
  console.log('ЁЯУ╖ Starting scan simulation');
  
  if (isScanning) {
    console.log('тЪая╕П Scan already in progress');
    return;
  }
  
  const scanBtn = document.getElementById('scanBtn');
  if (!scanBtn) {
    console.error('тЭМ Scan button not found');
    return;
  }
  
  isScanning = true;
  
  // Update button state
  scanBtn.disabled = true;
  scanBtn.innerHTML = 'ЁЯУ╖ рд╕реНрдХреИрди рд╣реЛ рд░рд╣рд╛ рд╣реИ... Scanning...';
  scanBtn.style.background = 'var(--color-warning)';
  
  showToast('ЁЯУ╖ рд╕реНрдХреИрдирд┐рдВрдЧ рд╢реБрд░реВ рдХреА рдЧрдИ - Scanning started', 'info');
  simulateHapticFeedback();
  
  // Simulate scanning process
  setTimeout(() => {
    const success = Math.random() > 0.25; // 75% success rate
    showScanResult(success);
    
    // Reset button
    scanBtn.disabled = false;
    scanBtn.innerHTML = 'ЁЯУ╖ рд╕реНрдХреИрди рд╢реБрд░реВ рдХрд░реЗрдВ - Start Scan';
    scanBtn.style.background = '';
    isScanning = false;
    
    simulateHapticFeedback(success ? 'success' : 'error');
  }, 3000);
}

function showScanResult(success) {
  console.log('ЁЯУЛ Showing scan result:', success);
  
  const modal = document.getElementById('scanResultModal');
  const resultIcon = document.getElementById('resultIcon');
  const resultTitle = document.getElementById('resultTitle');
  const resultMessage = document.getElementById('resultMessage');
  
  if (!modal || !resultIcon || !resultTitle || !resultMessage) {
    console.error('тЭМ Scan result elements not found');
    return;
  }
  
  const typeText = getScanTypeText(currentScanType);
  
  if (success) {
    resultIcon.innerHTML = 'тЬЕ';
    resultTitle.innerHTML = 'рд╕реНрдХреИрди рд╕рдлрд▓ - Scan Successful';
    resultMessage.innerHTML = `${typeText} рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рд╕реНрдХреИрди рдХрд┐рдпрд╛ рдЧрдпрд╛ред рд╕рднреА рдирд┐рдпрдореЛрдВ рдХрд╛ рдкрд╛рд▓рди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред`;
    showToast('тЬЕ рд╕реНрдХреИрди рд╕рдлрд▓ рд░рд╣рд╛ - Scan successful', 'success');
  } else {
    resultIcon.innerHTML = 'тЭМ';
    resultTitle.innerHTML = 'рд╕реНрдХреИрди рдЕрд╕рдлрд▓ - Scan Failed';
    resultMessage.innerHTML = `${typeText} рд╕реНрдХреИрди рдореЗрдВ рд╕рдорд╕реНрдпрд╛ред рдХреГрдкрдпрд╛ рджреЛрдмрд╛рд░рд╛ рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВред`;
    showToast('тЭМ рд╕реНрдХреИрди рдЕрд╕рдлрд▓ - Scan failed', 'error');
  }
  
  modal.classList.remove('hidden');
}

function closeScanResult() {
  console.log('тЭМ Closing scan result modal');
  const modal = document.getElementById('scanResultModal');
  if (modal) {
    modal.classList.add('hidden');
  }
  simulateHapticFeedback();
}

// Calendar functionality
function changeMonth(direction) {
  console.log('ЁЯУЕ Changing month:', direction);
  
  currentMonth += direction;
  
  if (currentMonth > 11) {
    currentMonth = 0;
    currentYear++;
  } else if (currentMonth < 0) {
    currentMonth = 11;
    currentYear--;
  }
  
  updateCalendar();
  simulateHapticFeedback();
  
  const monthNames = [
    'January', 'February', 'March', 'April', 'May', 'June',
    'July', 'August', 'September', 'October', 'November', 'December'
  ];
  
  showToast(`ЁЯУЕ ${monthNames[currentMonth]} ${currentYear} рджрд┐рдЦрд╛рдпрд╛ рдЧрдпрд╛`, 'info');
}

function updateCalendar() {
  console.log('ЁЯУЕ Updating calendar');
  
  const monthNames = [
    'January', 'February', 'March', 'April', 'May', 'June',
    'July', 'August', 'September', 'October', 'November', 'December'
  ];
  
  const monthHeader = document.querySelector('.calendar-month');
  if (monthHeader) {
    monthHeader.textContent = `${monthNames[currentMonth]} ${currentYear}`;
    console.log('тЬЕ Calendar updated to:', monthNames[currentMonth], currentYear);
  }
}

// Emergency contact functionality
function callEmergency(type) {
  console.log('ЁЯУЮ Emergency call:', type);
  
  let contact = appData.emergency_contacts[0];
  let message = `ЁЯУЮ рдкрд╢реБ рдЪрд┐рдХрд┐рддреНрд╕рдХ рдХреЛ рдХреЙрд▓: ${contact.name} (${contact.phone})`;
  
  showToast(message, 'warning');
  simulateHapticFeedback('success');
  
  setTimeout(() => {
    showToast('ЁЯУ▒ рдХреЙрд▓ рдХрдиреЗрдХреНрдЯ рд╣реЛ рдЧрдпрд╛ - Call connected', 'success');
  }, 2000);
}

// More tab functionality
function openTraining() {
  console.log('ЁЯУ╣ Opening training');
  showToast('ЁЯУ╣ рдкреНрд░рд╢рд┐рдХреНрд╖рдг рд╡реАрдбрд┐рдпреЛ рдЦреБрд▓ рд░рд╣реЗ рд╣реИрдВ - Opening training videos', 'info');
  simulateHapticFeedback();
  
  setTimeout(() => {
    showToast('ЁЯОе рдкреЛрд▓реНрдЯреНрд░реА рдлрд╛рд░реНрдорд┐рдВрдЧ рдХреЗ 25 рд╡реАрдбрд┐рдпреЛ рдЙрдкрд▓рдмреНрдз рд╣реИрдВ', 'success');
  }, 1500);
}

function openMarketPrices() {
  console.log('ЁЯУК Opening market prices');
  showToast('ЁЯУК рдмрд╛рдЬрд╛рд░ рднрд╛рд╡ рджреЗрдЦ рд░рд╣реЗ рд╣реИрдВ - Checking market prices', 'info');
  simulateHapticFeedback();
  
  setTimeout(() => {
    showToast('тВ╣ рдЖрдЬ: рдмреНрд░реЙрдпрд▓рд░ тВ╣85/kg, рдЕрдВрдбреЗ тВ╣6.5/piece', 'success');
  }, 1500);
}

function openWeatherForecast() {
  console.log('ЁЯМдя╕П Opening weather forecast');
  showToast('ЁЯМдя╕П рдореМрд╕рдо рдкреВрд░реНрд╡рд╛рдиреБрдорд╛рди рджреЗрдЦ рд░рд╣реЗ рд╣реИрдВ - Checking weather forecast', 'info');
  simulateHapticFeedback();
  
  setTimeout(() => {
    showToast('ЁЯМжя╕П рдХрд▓ рдмрд╛рд░рд┐рд╢ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ред рдлрд╛рд░реНрдо рдХреА рддреИрдпрд╛рд░реА рдХрд░реЗрдВ', 'warning');
  }, 1500);
}

function openEmergencyContacts() {
  console.log('ЁЯУЮ Opening emergency contacts');
  showToast('ЁЯУЮ рдЖрдкрд╛рддрдХрд╛рд▓реАрди рд╕рдВрдкрд░реНрдХ рдЦреБрд▓ рд░рд╣реЗ рд╣реИрдВ - Opening emergency contacts', 'info');
  simulateHapticFeedback();
  
  setTimeout(() => {
    showToast('ЁЯСитАНтЪХя╕П рдбреЙ. рдкреНрд░рд┐рдпрд╛ рдкрд╛рдЯрд┐рд▓: +91 9876543220 (24/7 рдЙрдкрд▓рдмреНрдз)', 'success');
  }, 1500);
}

function openHelp() {
  showToast('тЭУ рд╕рд╣рд╛рдпрддрд╛ рдХреЗрдВрджреНрд░ рдЦреБрд▓ рд░рд╣рд╛ рд╣реИ - Opening help center', 'info');
  simulateHapticFeedback();
}

function openSettings() {
  showToast('ЁЯМР рднрд╛рд╖рд╛ рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдЦреБрд▓ рд░рд╣реА рд╣реИрдВ - Opening language settings', 'info');
  simulateHapticFeedback();
}

function openProfile() {
  showToast('ЁЯСд рдкреНрд░реЛрдлрд╛рдЗрд▓ рдЦреБрд▓ рд░рд╣реА рд╣реИ - Opening profile', 'info');
  simulateHapticFeedback();
}

function openSchemes() {
  showToast('ЁЯПЫя╕П рд╕рд░рдХрд╛рд░реА рдпреЛрдЬрдирд╛рдПрдВ рдЦреБрд▓ рд░рд╣реА рд╣реИрдВ - Opening government schemes', 'info');
  simulateHapticFeedback();
}

function openChat() {
  showToast('ЁЯдЦ рдЪреИрдЯрдмреЙрдЯ рд╢реБрд░реВ рд╣реЛ рд░рд╣рд╛ рд╣реИ - Starting chatbot', 'info');
  simulateHapticFeedback();
  
  setTimeout(() => {
    showToast('ЁЯТм рдирдорд╕реНрдХрд╛рд░! рдореИрдВ рдЖрдкрдХреА рдЦреЗрддреА рдореЗрдВ рдХреИрд╕реЗ рдорджрдж рдХрд░ рд╕рдХрддрд╛ рд╣реВрдВ?', 'success');
  }, 1500);
}

// Utility functions
function showToast(message, type = 'info') {
  console.log('ЁЯНЮ Toast:', message, type);
  
  // Remove existing toasts
  const existingToast = document.querySelector('.toast');
  if (existingToast) {
    existingToast.remove();
  }
  
  // Create toast element
  const toast = document.createElement('div');
  toast.className = `toast toast-${type}`;
  toast.innerHTML = `
    <div class="toast-content">
      <span class="toast-message">${message}</span>
      <button class="toast-close" onclick="this.parentElement.parentElement.remove()">├Ч</button>
    </div>
  `;
  
  // Set toast styles based on type
  const borderColors = {
    success: 'var(--color-success)',
    error: 'var(--color-error)',
    warning: 'var(--color-warning)',
    info: 'var(--color-primary)'
  };
  
  toast.style.borderColor = borderColors[type] || borderColors.info;
  
  // Add toast to body
  document.body.appendChild(toast);
  
  // Auto remove after 4 seconds
  setTimeout(() => {
    if (toast && toast.parentElement) {
      toast.style.animation = 'slideUp 0.3s ease';
      setTimeout(() => {
        if (toast.parentElement) {
          toast.remove();
        }
      }, 300);
    }
  }, 4000);
}

function simulateHapticFeedback(type = 'light') {
  // Simulate haptic feedback through vibration API if available
  if ('vibrate' in navigator) {
    const patterns = {
      light: [50],
      success: [50, 50, 50],
      error: [100, 50, 100],
      warning: [75, 25, 75]
    };
    navigator.vibrate(patterns[type] || patterns.light);
  }
}

function updateNetworkStatus() {
  const statusIndicator = document.querySelector('.status-indicator');
  const statusText = document.querySelector('.status-text');
  
  if (!statusIndicator || !statusText) return;
  
  const isOnline = navigator.onLine !== false;
  
  if (isOnline) {
    statusIndicator.classList.add('online');
    statusText.textContent = 'Online';
    statusIndicator.style.backgroundColor = 'var(--color-success)';
  } else {
    statusIndicator.classList.remove('online');
    statusIndicator.style.backgroundColor = 'var(--color-warning)';
    statusText.textContent = 'Offline';
  }
}

// Handle orientation changes
window.addEventListener('orientationchange', function() {
  setTimeout(() => {
    window.scrollTo(0, 0);
  }, 100);
});

// Handle app visibility changes
document.addEventListener('visibilitychange', function() {
  if (!document.hidden) {
    updateNetworkStatus();
  }
});

// Prevent zoom on double tap
let lastTouchEnd = 0;
document.addEventListener('touchend', function(event) {
  const now = (new Date()).getTime();
  if (now - lastTouchEnd <= 300) {
    event.preventDefault();
  }
  lastTouchEnd = now;
}, false);

// Global error handlers
window.addEventListener('error', function(e) {
  console.error('тЭМ App Error:', e.error);
  showToast('тЪая╕П рдХреБрдЫ рдЧрд▓рдд рд╣реБрдЖ рд╣реИ - Something went wrong. Please try again.', 'error');
});

window.addEventListener('unhandledrejection', function(e) {
  console.error('тЭМ Unhandled Promise:', e.reason);
  showToast('тЪая╕П рдХрдиреЗрдХреНрд╢рди рдХреА рд╕рдорд╕реНрдпрд╛ - Connection issue. Please check network.', 'warning');
});

// Final initialization log
console.log('ЁЯМ╛ Kisan Sahayak - Smallholder Farmer App Initialized Successfully');
console.log('ЁЯУ▒ Frame Size: 414x896px | Language: Hindi + English | Features: All Active');